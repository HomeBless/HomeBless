{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block content %}
<div class="pt-[178px] pb-[60px]">
    {% include "components/search_bar.html" %}
<div class="flex">
    {% include "components/filter.html" %}

    <div id="body" class="w-3/4 h-auto p-[30px] flex-col justify-start items-center gap-8 inline-flex">
        <button id="open-filter"
                class="hidden fixed top-4 left-4 bg-blue-500 text-white px-4 py-2 rounded-lg">
            Open Filter
        </button>
        <div class="self-stretch text-center"><span class="text-[#575b6f] text-[32px] font-bold font-['IBM Plex Sans Thai']">ผลการค้นหา </span><span class="text-[#2162d0] text-[32px] font-bold font-['IBM Plex Sans Thai']">“ลาดพร้าว”</span></div>
        <div class="self-stretch h-auto flex-col justify-start items-center gap-2 flex">
            <div class="self-stretch justify-end items-center inline-flex">
                <div class="text-center text-[#575b6f] text-base font-normal font-['IBM Plex Sans Thai']">เรียงตาม:</div>
                <div class="p-2.5 justify-start items-center gap-2.5 flex">
                    <div class="justify-start items-center gap-0.5 flex">
                        <div class="text-[#575b6f] text-base font-bold font-['IBM Plex Sans Thai']">เวลาที่ลงขาย (ล่าสุดก่อน)</div>
                        <img src="{% static 'property-listing/arrowdown.svg' %}" alt="ArrowDown">
                    </div>
                </div>
            </div>
            <div class="flex flex-wrap gap-6 justify-center">
                {% for property in properties %}
                <a href="{% url 'HomeBless:property-detail' property.id %}">
                <div class="h-auto p-5 rounded-[10px] border border-[#d0d8ef] flex-col justify-start items-start gap-4 inline-flex">
                <img src="{{ property.main_image }}" class="w-full h-[222px] rounded-md object-cover" alt="PropertyPicture">
                    <div data-svg-wrapper>

                <div class="self-stretch h-[249px] flex-col justify-start items-start gap-4 flex">
                    <div class="self-stretch h-[180px] flex-col justify-start items-start gap-4 flex">
                        <div class="self-stretch justify-between items-center inline-flex">
                            <div class="w-[371px] text-[#444f85] text-base font-bold font-['IBM Plex Sans Thai'] line-clamp-2">{{ property.title }}</div>
                            <form method="POST" action="{% url 'HomeBless:property-listing' %}">
                                {% csrf_token %}
                                <input type="hidden" name="property_id" value="{{ property.id }}">
                                <button onclick="toggleBookmark(this)" class="relative p-2 rounded-full transition-transform duration-200 hover:scale-110 focus:outline-none">
                                    <span class="absolute inset-0 rounded-full bg-blue-500 opacity-0 scale-50 transition-all duration-300 ease-out group-hover:opacity-20"></span>
                                    <img id="bookmark-icon"
                                         src="{% if wishlist_bool %}{% static 'property-listing/booked.svg' %}{% else %}{% static 'property-listing/bookmark.svg' %}{% endif %}"
                                         alt="Bookmark"
                                         class="w-15 h-15 relative z-10">
                                </button>
                            </form>
{#                            <img src="{% static 'property-listing/bookmark.svg' %}" alt="Bookmark">#}
{#                        <form method="POST" action="{% url 'HomeBless:property-detail' pk=property.pk %}">#}
{#                            {% csrf_token %}#}
{#                            <input type="hidden" name="bookmark_property" value="{{ property.id }}">#}
{#                            <button onclick="toggleBookmark(this)" class="relative p-2 rounded-full transition-transform duration-200 hover:scale-110 focus:outline-none">#}
{#                                <span class="absolute inset-0 rounded-full bg-blue-500 opacity-0 scale-50 transition-all duration-300 ease-out group-hover:opacity-20"></span>#}
{#                                <img id="bookmark-icon" #}
{#                                     src="{% if wishlist_bool %}{% static 'property-detail/booked.svg' %}{% else %}{% static 'property-detail/bookmark.svg' %}{% endif %}" #}
{#                                     alt="Bookmark" #}
{#                                     class="w-15 h-15 relative z-10">#}
{#                            </button>#}
{#                        </form>#}
                        </div>
                        <div class="px-[9px] py-2 bg-[#2162d0] rounded-md justify-center items-center gap-1.5 inline-flex">
                            <img src="{% static 'property-listing/location.svg' %}" alt="Location">
                            <div class="text-[#faf9f6] text-xs font-normal font-['IBM Plex Sans Thai'] max-w-[150px] truncate overflow-hidden whitespace-nowrap">
                                {{ property.location }}
                            </div>
                        </div>
                        <div class="self-stretch justify-start items-center inline-flex">
                            <div class="px-2.5 border-r border-[#575b6f] justify-start items-center gap-1.5 flex">
                                <div data-svg-wrapper class="relative">
                                    <img src="{% static 'property-listing/area.svg' %}" alt="Area">
                                </div>
                                <div class="text-[#575b6f] text-xs font-normal font-['IBM Plex Sans Thai']">{{ property.area }} ตร.ว.</div>
                            </div>
                            <div class="px-2.5 justify-start items-center gap-1.5 flex">
                                    <img src="{% static 'property-listing/floor.svg' %}" alt="Floor">
                                <div class="text-[#575b6f] text-xs font-normal font-['IBM Plex Sans Thai']">{{ property.floors }} ชั้น</div>
                            </div>
                            <div class="px-2.5 border-l border-r border-[#575b6f] justify-start items-center gap-1.5 flex">
                                <img src="{% static 'property-listing/bedroom.svg' %}" alt="Bedroom">
                                <div class="text-[#575b6f] text-xs font-normal font-['IBM Plex Sans Thai']">{{ property.bedrooms }} ห้องนอน</div>
                            </div>
                            <div class="px-2.5 justify-start items-center gap-1.5 flex">
                                <img src="{% static 'property-listing/bathroom.svg' %}" alt="Bathroom">
                                <div class="text-[#575b6f] text-xs font-normal font-['IBM Plex Sans Thai']">{{ property.bathrooms }} ห้องน้ำ</div>
                            </div>
                        </div>
                        <div class="justify-start items-center gap-2 inline-flex">
                            <div class="px-2 py-0.5 bg-[#faf9f6] rounded-md border border-[#d0d8ef] justify-center items-center gap-1.5 flex">
                                <div class="text-[#575b6f] text-xs font-normal font-['IBM Plex Sans Thai']">เลี้ยงสัตว์ได้</div>
                            </div>
                            <div class="px-2 py-0.5 bg-[#faf9f6] rounded-md border border-[#d0d8ef] justify-center items-center gap-1.5 flex">
                                <div class="text-[#575b6f] text-xs font-normal font-['IBM Plex Sans Thai']">ใกล้อีสวิวล์</div>
                            </div>
                        </div>
                    </div>
                    <div class="self-stretch justify-start items-center gap-2 inline-flex">
                        <div class="grow shrink basis-0 text-[#2DAB6F] text-[32px] font-bold font-['IBM Plex Sans Thai']">
                            {{ property.price|intcomma }}</div>
                        <div class="text-[#2DAB6F] text-[32px] font-bold font-['IBM Plex Sans Thai']">
                            บาท{% if property.transaction_type == "rent" %}/ด.{% endif %}
                        </div>
                    </div>
                </div>
                </div>
            </div>
            </a>
            {% endfor %}
        </div>
        <div class="p-2.5 pb-20 justify-start items-center gap-4 inline-flex">
            <div class="justify-start items-center gap-2 flex">
                <img src="{% static 'property-listing/double-arrow-left.svg' %}" alt="DoubleArrow">
                <img src="{% static 'property-listing/single-arrow-left.svg' %}" alt="Arrow">
                <div class="w-10 h-10 bg-[#2162d0] rounded-[50px] flex-col justify-center items-center gap-1.5 inline-flex">
                    <div class="self-stretch text-center text-[#faf9f6] text-base font-normal font-['IBM Plex Sans Thai']">1</div>
                </div>
                <div class="w-10 h-10 rounded-[50px] flex-col justify-center items-center gap-1.5 inline-flex">
                    <div class="self-stretch text-center text-[#444f85] text-base font-normal font-['IBM Plex Sans Thai']">2</div>
                </div>
                <div class="w-10 h-10 rounded-[50px] flex-col justify-center items-center gap-1.5 inline-flex">
                    <div class="self-stretch text-center text-[#444f85] text-base font-normal font-['IBM Plex Sans Thai']">3</div>
                </div>
                <div class="w-10 h-10 rounded-[50px] flex-col justify-center items-center gap-1.5 inline-flex">
                    <div class="self-stretch text-center text-[#444f85] text-base font-normal font-['IBM Plex Sans Thai']">4</div>
                </div>
                <div class="w-10 h-10 rounded-[50px] flex-col justify-center items-center gap-1.5 inline-flex">
                    <div class="self-stretch text-center text-[#444f85] text-base font-normal font-['IBM Plex Sans Thai']">5</div>
                </div>
                <div class="w-10 h-10 rounded-[50px] flex-col justify-center items-center gap-1.5 inline-flex">
                    <div class="self-stretch text-center text-[#444f85] text-base font-normal font-['IBM Plex Sans Thai']">...</div>
                </div>
                <div class="w-10 h-10 rounded-[50px] flex-col justify-center items-center gap-1.5 inline-flex">
                    <div class="self-stretch text-center text-[#444f85] text-base font-normal font-['IBM Plex Sans Thai']">100</div>
                </div>
                <img src="{% static 'property-listing/double-arrow-right.svg' %}" alt="DoubleArrow">
                <img src="{% static 'property-listing/single-arrow-right.svg' %}" alt="Arrow">
            </div>
            <div class="pl-5 border-l border-[#d0d8ef] justify-start items-center gap-[5px] flex">
                <div class="h-[46px] p-2.5 bg-[#faf9f6] rounded-[10px] border border-[#a6abc6] justify-start items-center gap-2.5 flex">
                    <div class="text-[#a6abc6] text-base font-normal font-['IBM Plex Sans Thai']"></div>
                </div>
                <button class="justify-start items-center flex">
                    <div class="text-center text-[#444f85] text-base font-normal font-['IBM Plex Sans Thai']">Go</div>
                    <img src="{% static 'property-listing/go-arrow.svg' %}" alt="Arrow">
                </button>
            </div>
        </div>
    </div>
</div>
</div>

<script>
    const filter = document.getElementById("filter");
    
    filter.addEventListener("mouseenter", () => {
    document.body.style.overflow = "hidden";
    });
    
    filter.addEventListener("mouseleave", () => {
    document.body.style.overflow = "auto";
    });
    
    document.getElementById("close-filter").addEventListener("click", function() {
        document.getElementById("filter").style.display = "none"; // Hide filter
        document.getElementById("body").classList.remove("w-3/4");
        document.getElementById("body").classList.add("w-full");
        document.getElementById("open-filter").classList.remove("hidden"); // Show open button
    });
    
    document.getElementById("open-filter").addEventListener("click", function() {
        document.getElementById("filter").style.display = "block"; // Show filter
        document.getElementById("body").classList.remove("w-full");
        document.getElementById("body").classList.add("w-3/4");
        document.getElementById("open-filter").classList.add("hidden"); // Hide open button
    });
    
    {#basic filter#}
    document.getElementById("basic-filter-arrow").addEventListener("click", function() {
    let filter = document.getElementById("basic-filter");
    let arrow = document.getElementById("basic-filter-arrow");
    
    // Toggle visibility
    if (filter.style.display === "none") {
        filter.style.display = "block"; // Show filter
        arrow.style.transform = "rotate(0deg)"; // Reset arrow rotation
    } else {
        filter.style.display = "none"; // Hide filter
        arrow.style.transform = "rotate(180deg)"; // Rotate arrow
    }
    });
    
    {#charac filter#}
    document.getElementById("charac-filter-arrow").addEventListener("click", function() {
    let filter = document.getElementById("charac-filter");
    let arrow = document.getElementById("charac-filter-arrow");
    
    // Toggle visibility
    if (filter.style.display === "none") {
        filter.style.display = "block"; // Show filter
        arrow.style.transform = "rotate(0deg)"; // Reset arrow rotation
    } else {
        filter.style.display = "none"; // Hide filter
        arrow.style.transform = "rotate(180deg)"; // Rotate arrow
    }
    });
    
    function toggleBookmark(button) {
        const icon = button.querySelector('#bookmark-icon');
        const ring = button.querySelector('span');
        const isBooked = icon.src.includes('booked.svg');
        
        // Toggle the image source
        icon.src = isBooked ? "{% static 'property-listing/bookmark.svg' %}" : "{% static 'property-listing/booked.svg' %}";
    
        // Add animation
        ring.classList.add('ring-animate');
        setTimeout(() => {
            ring.classList.remove('ring-animate');
        }, 300);
    }
    
</script>
{% endblock %}