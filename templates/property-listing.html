{% extends 'base.html' %}
{% load static %}
{% load humanize %}
{% load query_transform %}

{% block content %}
<div class="pt-[178px] pb-[60px]">
    <!-- Search Header -->
<div class="w-full h-[86px] px-[30px] py-5 border-b border-[#d0d8ef] justify-center items-center gap-[30px] inline-flex fixed top-[92px] left-0 bg-white z-[1]">
    <div class="grow shrink basis-0 flex-col justify-start items-start gap-1.5 inline-flex">
        <div class="self-stretch p-2.5 bg-[#faf9f6] rounded-[10px] border border-[#a6abc6] justify-start items-center gap-2.5 inline-flex">
            <img src="{% static 'property-listing/search.svg' %}" alt="Search">
            <!-- Add id="search-form" to the form -->
            <form method="GET" action="{% url 'HomeBless:property-listing' %}" id="search-form" class="grow shrink basis-0 h-[26px] justify-between items-center flex">
                <input type="text" name="q" value="{{ current_filters.q }}" placeholder="คีย์เวิร์ด, สถานที่สำคัญ, จังหวัด ฯลฯ"
                    class="w-full h-full text-[#444f85] placeholder:text-[#a6abc6] text-base font-normal font-['IBM Plex Sans Thai'] bg-transparent outline-none border-none" />
                <!-- Hidden fields to maintain other filters -->
                <input type="hidden" name="property_type" value="{{ current_filters.property_type }}">
                <input type="hidden" name="transaction_type" value="{{ current_filters.transaction_type }}">
                <input type="hidden" name="min_price" value="{{ current_filters.min_price }}">
                <input type="hidden" name="max_price" value="{{ current_filters.max_price }}">
                <input type="hidden" name="bedrooms" value="{{ current_filters.bedrooms }}">
                <input type="hidden" name="bathrooms" value="{{ current_filters.bathrooms }}">
                <input type="hidden" name="min_area" value="{{ current_filters.min_area }}">
                <input type="hidden" name="max_area" value="{{ current_filters.max_area }}">
            </form>
        </div>
    </div>
    <div class="px-8 border-l border-r border-[#d0d8ef] justify-start items-center gap-4 flex">
        <!-- Price Range Filter -->
        <div class="relative">
            <form method="GET" id="price-form">
                <select name="price_range" onchange="this.form.submit()" class="h-[46px] px-2.5 bg-[#faf9f6] rounded-[10px] border border-[#2162d0] text-[#2162d0] text-base font-normal font-['IBM Plex Sans Thai'] appearance-none pr-8">
                    <option value="" {% if not current_filters.price_range %}selected{% endif %}>ช่วงราคา</option>
                    <option value="below500k" {% if current_filters.price_range == 'below500k' %}selected{% endif %}>ต่ำกว่า 500,000</option>
                    <option value="500k-2m" {% if current_filters.price_range == '500k-2m' %}selected{% endif %}>500,000-2,000,000</option>
                    <option value="2m-5m" {% if current_filters.price_range == '2m-5m' %}selected{% endif %}>2,000,000-5,000,000</option>
                    <option value="5m-8m" {% if current_filters.price_range == '5m-8m' %}selected{% endif %}>5,000,000-8,000,000</option>
                    <option value="8m-10m" {% if current_filters.price_range == '8m-10m' %}selected{% endif %}>8,000,000-10,000,000</option>
                    <option value="morethan10m" {% if current_filters.price_range == 'morethan10m' %}selected{% endif %}>มากกว่า 10,000,000</option>
                </select>
                <!-- Hidden fields to maintain other filters -->
                <input type="hidden" name="q" value="{{ current_filters.q }}">
                <input type="hidden" name="property_type" value="{{ current_filters.property_type }}">
                <input type="hidden" name="transaction_type" value="{{ current_filters.transaction_type }}">
                <input type="hidden" name="bedrooms" value="{{ current_filters.bedrooms }}">
                <input type="hidden" name="bathrooms" value="{{ current_filters.bathrooms }}">
                <input type="hidden" name="min_area" value="{{ current_filters.min_area }}">
                <input type="hidden" name="max_area" value="{{ current_filters.max_area }}">
            </form>
            <div class="absolute top-1/2 right-3 -translate-y-1/2 pointer-events-none">
                <img src="{% static 'property-listing/arrowdown.svg' %}" alt="ArrowDown">
            </div>
        </div>
        
        <!-- Transaction Type Filter -->
        <div class="relative">
            <form method="GET" id="transaction-form">
                <select name="transaction_type" onchange="this.form.submit()" class="h-[46px] px-2.5 bg-[#faf9f6] rounded-[10px] border border-[#2162d0] text-[#2162d0] text-base font-normal font-['IBM Plex Sans Thai'] appearance-none pr-8">
                    <option value="" {% if not current_filters.transaction_type %}selected{% endif %}>ประกาศ</option>
                    <option value="buy" {% if current_filters.transaction_type == 'buy' %}selected{% endif %}>ขาย</option>
                    <option value="rent" {% if current_filters.transaction_type == 'rent' %}selected{% endif %}>ให้เช่า</option>
                </select>
                <!-- Hidden fields to maintain other filters -->
                <input type="hidden" name="q" value="{{ current_filters.q }}">
                <input type="hidden" name="property_type" value="{{ current_filters.property_type }}">
                <input type="hidden" name="price_range" value="{{ current_filters.price_range }}">
                <input type="hidden" name="bedrooms" value="{{ current_filters.bedrooms }}">
                <input type="hidden" name="bathrooms" value="{{ current_filters.bathrooms }}">
                <input type="hidden" name="min_area" value="{{ current_filters.min_area }}">
                <input type="hidden" name="max_area" value="{{ current_filters.max_area }}">
            </form>
            <div class="absolute top-1/2 right-3 -translate-y-1/2 pointer-events-none">
                <img src="{% static 'property-listing/arrowdown.svg' %}" alt="ArrowDown">
            </div>
        </div>
        
        <div class="h-[46px] p-2.5 bg-[#faf9f6] rounded-[10px] border border-[#2162d0] justify-start items-center gap-2.5 flex">
            <div class="justify-start items-center gap-0.5 flex">
                <div class="text-[#2162d0] text-base font-normal font-['IBM Plex Sans Thai']">กรองเพิ่มเติม</div>
                <div data-svg-wrapper class="relative">
                    <img src="{% static 'property-listing/divider.svg' %}" alt="Divider">
                </div>
            </div>
        </div>
    </div>
    <!-- Update the search button to properly submit the form -->
    <button type="submit" form="search-form" class="p-2.5 bg-[#2162d0] rounded-[10px] justify-center items-center gap-2.5 flex hover:bg-[#1a4fa0] transition-colors">
        <div class="text-[#faf9f6] text-base font-normal font-['IBM Plex Sans Thai']">ค้นหาเลย!</div>
    </button>
</div>

<!-- Add this JavaScript to handle form submission -->
<script>
    // Make sure the search form submits when pressing Enter in the search field
    document.querySelector('#search-form input[name="q"]').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            document.getElementById('search-form').submit();
        }
    });
</script>

    <div class="flex">
        <!-- Filter Sidebar -->
        <div id="filter" class="w-1/4 h-screen overflow-y-auto sticky top-[178px] border-r border-[#d0d8ef] flex-col justify-start items-start inline-flex">
            <div class="self-stretch px-[30px] py-5 border-b-2 border-[#d0d8ef] justify-between items-center inline-flex">
                <div class="justify-start items-center gap-4 flex">
                    <img src="{% static 'property-listing/filter.svg' %}" alt="Filter">
                    <div class="text-[#575b6f] text-[22px] font-medium font-['IBM Plex Sans Thai']">ตัวกรอง</div>
                </div>
                <img src="{% static 'property-listing/close.svg' %}" alt="Close" class="w-22 h-22 cursor-pointer" id="close-filter">
            </div>
            
            <!-- Applied Filters Section -->
            <div class="self-stretch h-auto px-[30px] py-5 border-b-2 border-[#d0d8ef] flex-col justify-start items-start gap-6 flex">
                <div class="self-stretch justify-between items-center inline-flex">
                    <div class="justify-start items-center gap-4 flex">
                        <div data-svg-wrapper class="relative">
                            <img src="{% static 'property-listing/apply.svg' %}" alt="Filter">
                        </div>
                        <div class="text-[#575b6f] text-[22px] font-medium font-['IBM Plex Sans Thai']">ตัวกรองที่ใส่แล้ว</div>
                    </div>
                    <a href="{% url 'HomeBless:property-listing' %}" class="justify-start items-center gap-2 flex">
                        <div class="text-[#575b6f] text-[22px] font-medium font-['IBM Plex Sans Thai']">ล้าง</div>
                        <img src="{% static 'property-listing/x.svg' %}" alt="Delete">
                    </a>
                </div>
                <div class="justify-start items-center gap-4 inline-flex flex-wrap">
                    {% if current_filters.property_type %}
                        <a href="?{% query_transform request property_type=None %}" class="p-2.5 bg-[#2162d0] rounded-[10px] justify-center items-center gap-2 flex">
                            <div class="text-[#faf9f6] text-base font-normal font-['IBM Plex Sans Thai']">
                                {{ current_filters.property_type|title }}
                            </div>
                            <img src="{% static 'property-listing/x-white.svg' %}" alt="Delete">
                        </a>
                    {% endif %}
                    {% if current_filters.transaction_type %}
                        <a href="?{% query_transform request transaction_type=None %}" class="p-2.5 bg-[#2162d0] rounded-[10px] justify-center items-center gap-2 flex">
                            <div class="text-[#faf9f6] text-base font-normal font-['IBM Plex Sans Thai']">
                                {% if current_filters.transaction_type == 'buy' %}ขาย{% else %}ให้เช่า{% endif %}
                            </div>
                            <img src="{% static 'property-listing/x-white.svg' %}" alt="Delete">
                        </a>
                    {% endif %}
                    {% if current_filters.price_range %}
                        <a href="?{% query_transform request price_range=None %}" class="p-2.5 bg-[#2162d0] rounded-[10px] justify-center items-center gap-2 flex">
                            <div class="text-[#faf9f6] text-base font-normal font-['IBM Plex Sans Thai']">
                                {% if current_filters.price_range == 'below500k' %}ต่ำกว่า 500,000
                                {% elif current_filters.price_range == '500k-2m' %}500,000-2,000,000
                                {% elif current_filters.price_range == '2m-5m' %}2,000,000-5,000,000
                                {% elif current_filters.price_range == '5m-8m' %}5,000,000-8,000,000
                                {% elif current_filters.price_range == '8m-10m' %}8,000,000-10,000,000
                                {% elif current_filters.price_range == 'morethan10m' %}มากกว่า 10,000,000{% endif %}
                            </div>
                            <img src="{% static 'property-listing/x-white.svg' %}" alt="Delete">
                        </a>
                    {% endif %}
                    {% if current_filters.bedrooms %}
                        <a href="?{% query_transform request bedrooms=None %}" class="p-2.5 bg-[#2162d0] rounded-[10px] justify-center items-center gap-2 flex">
                            <div class="text-[#faf9f6] text-base font-normal font-['IBM Plex Sans Thai']">{{ current_filters.bedrooms }} ห้องนอน</div>
                            <img src="{% static 'property-listing/x-white.svg' %}" alt="Delete">
                        </a>
                    {% endif %}
                </div>
            </div>
            
            <!-- Basic Filters Section -->
            <form method="GET" id="filter-form" class="w-full">
                <!-- Hidden fields to maintain other filters -->
                <input type="hidden" name="q" value="{{ current_filters.q }}">
                
                <div class="self-stretch h-auto px-[30px] py-5 border-b-2 border-[#d0d8ef] flex-col justify-start items-start gap-6 flex">
                    <div class="self-stretch justify-between items-center inline-flex">
                        <div class="text-[#575b6f] text-[22px] font-medium font-['IBM Plex Sans Thai']">ตัวกรองพื้นฐาน</div>
                        <img id="basic-filter-arrow" src="{% static 'property-listing/arrow.svg' %}" alt="arrow" class="w-6 h-6 cursor-pointer transition-transform duration-300">
                    </div>
                    <div id="basic-filter" class="w-full">
                        <div class="flex-col justify-start items-start gap-2 flex">
                            <div class="text-[#575b6f] text-base font-bold font-['IBM Plex Sans Thai']">ประเภทของอสังหา</div>
                            <div class="justify-start items-center gap-4 inline-flex flex-wrap">
                                {% for value, label in property_type_choices %}
                                    <button type="submit" name="property_type" value="{{ value }}"
                                        class="p-2.5 {% if current_filters.property_type == value %}bg-[#2162d0] text-[#faf9f6]{% else %}bg-[#faf9f6] text-[#575b6f]{% endif %} rounded-[10px] border border-[#d0d8ef] justify-center items-center gap-2 flex">
                                        <div class="text-base font-normal font-['IBM Plex Sans Thai']">{{ label }}</div>
                                    </button>
                                {% endfor %}
                            </div>
                        </div>
                        
                        <div class="self-stretch h-auto flex-col justify-start items-start gap-2 flex mt-4">
                            <div class="text-[#575b6f] text-base font-bold font-['IBM Plex Sans Thai']">ช่วงราคาขาย</div>
                            <div class="self-stretch justify-start items-center gap-4 inline-flex">
                                <input type="number" name="min_price" value="{{ current_filters.min_price }}"
                                    placeholder="Min" onchange="this.form.submit()"
                                    class="grow shrink basis-0 h-[46px] p-2.5 bg-[#faf9f6] rounded-[10px] border border-[#d0d8ef] text-[#575b6f] text-base font-normal font-['IBM Plex Sans Thai'] text-center outline-none">
                                <input type="number" name="max_price" value="{{ current_filters.max_price }}"
                                    placeholder="Max" onchange="this.form.submit()"
                                    class="grow shrink basis-0 h-[46px] p-2.5 bg-[#faf9f6] rounded-[10px] border border-[#d0d8ef] text-[#575b6f] text-base font-normal font-['IBM Plex Sans Thai'] text-center outline-none">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Property Characteristics Section -->
                <div class="self-stretch h-auto px-[30px] py-5 border-b-2 border-[#d0d8ef] flex-col justify-start items-start gap-6 flex">
                    <div class="self-stretch justify-between items-center inline-flex">
                        <div class="text-[#575b6f] text-[22px] font-medium font-['IBM Plex Sans Thai']">ลักษณะบ้าน</div>
                        <img id="charac-filter-arrow" src="{% static 'property-listing/arrow.svg' %}" alt="arrow" class="w-6 h-6 cursor-pointer transition-transform duration-300">
                    </div>
                    <div id="charac-filter" class="w-full">
                        <!-- Bedrooms Filter -->
                        <div class="self-stretch h-auto flex-col justify-start items-start gap-2 flex">
                            <div class="text-[#575b6f] text-base font-bold font-['IBM Plex Sans Thai']">จำนวนห้องนอน</div>
                            <div class="self-stretch justify-start items-center gap-4 flex flex-wrap">
                                {% for i in "12345" %}
                                    <button type="submit" name="bedrooms" value="{{ i }}"
                                        class="p-2.5 {% if current_filters.bedrooms == i %}bg-[#2162d0] text-[#faf9f6]{% else %}bg-[#faf9f6] text-[#575b6f]{% endif %} rounded-[10px] border border-[#d0d8ef] justify-center items-center gap-2 flex">
                                        <div class="text-base font-normal font-['IBM Plex Sans Thai']">{{ i }} ห้องนอน</div>
                                    </button>
                                {% endfor %}
                                <button type="submit" name="bedrooms" value="6"
                                    class="p-2.5 {% if current_filters.bedrooms == '6' %}bg-[#2162d0] text-[#faf9f6]{% else %}bg-[#faf9f6] text-[#575b6f]{% endif %} rounded-[10px] border border-[#d0d8ef] justify-center items-center gap-2 flex">
                                    <div class="text-base font-normal font-['IBM Plex Sans Thai']">มากกว่า 5 ห้องนอน</div>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Bathrooms Filter -->
                        <div class="self-stretch h-auto flex-col justify-start items-start gap-2 flex mt-4">
                            <div class="text-[#575b6f] text-base font-bold font-['IBM Plex Sans Thai']">จำนวนห้องน้ำ</div>
                            <div class="self-stretch justify-start items-center gap-4 flex flex-wrap">
                                {% for i in "12345" %}
                                    <button type="submit" name="bathrooms" value="{{ i }}"
                                        class="p-2.5 {% if current_filters.bathrooms == i %}bg-[#2162d0] text-[#faf9f6]{% else %}bg-[#faf9f6] text-[#575b6f]{% endif %} rounded-[10px] border border-[#d0d8ef] justify-center items-center gap-2 flex">
                                        <div class="text-base font-normal font-['IBM Plex Sans Thai']">{{ i }} ห้องน้ำ</div>
                                    </button>
                                {% endfor %}
                                <button type="submit" name="bathrooms" value="6"
                                    class="p-2.5 {% if current_filters.bathrooms == '6' %}bg-[#2162d0] text-[#faf9f6]{% else %}bg-[#faf9f6] text-[#575b6f]{% endif %} rounded-[10px] border border-[#d0d8ef] justify-center items-center gap-2 flex">
                                    <div class="text-base font-normal font-['IBM Plex Sans Thai']">มากกว่า 5 ห้องน้ำ</div>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Parking Filter -->
                        <div class="self-stretch h-auto flex-col justify-start items-start gap-2 flex mt-4">
                            <div class="text-[#575b6f] text-base font-bold font-['IBM Plex Sans Thai']">จำนวนที่จอดรถ</div>
                            <div class="self-stretch justify-start items-center gap-4 flex flex-wrap">
                                {% for i in "01234" %}
                                    <button type="submit" name="garages" value="{{ i }}"
                                        class="p-2.5 {% if current_filters.garages == i %}bg-[#2162d0] text-[#faf9f6]{% else %}bg-[#faf9f6] text-[#575b6f]{% endif %} rounded-[10px] border border-[#d0d8ef] justify-center items-center gap-2 flex">
                                        <div class="text-base font-normal font-['IBM Plex Sans Thai']">
                                            {% if i == '0' %}ไม่มี{% else %}{{ i }} คัน{% endif %}
                                        </div>
                                    </button>
                                {% endfor %}
                            </div>
                        </div>
                        
                        <!-- Area Filter -->
                        <div class="self-stretch h-auto flex-col justify-start items-start gap-2 flex mt-4">
                            <div class="text-[#575b6f] text-base font-bold font-['IBM Plex Sans Thai']">ขนาดพื้นที่ใช้สอย</div>
                            <div class="self-stretch justify-start items-center gap-4 inline-flex w-full">
                                <input type="number" name="min_area" value="{{ current_filters.min_area }}"
                                    placeholder="min" onchange="this.form.submit()"
                                    class="grow shrink basis-0 h-[46px] p-2.5 bg-[#faf9f6] rounded-[10px] border border-[#d0d8ef] text-[#575b6f] text-base font-normal font-['IBM Plex Sans Thai'] text-center outline-none">
                                <input type="number" name="max_area" value="{{ current_filters.max_area }}"
                                    placeholder="max" onchange="this.form.submit()"
                                    class="grow shrink basis-0 h-[46px] p-2.5 bg-[#faf9f6] rounded-[10px] border border-[#d0d8ef] text-[#575b6f] text-base font-normal font-['IBM Plex Sans Thai'] text-center outline-none">
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Main Content -->
        <div id="body" class="w-3/4 h-auto p-[30px] flex-col justify-start items-center gap-8 inline-flex">
            <button id="open-filter" class="hidden fixed top-4 left-4 bg-blue-500 text-white px-4 py-2 rounded-lg">
                Open Filter
            </button>
            
            <div class="self-stretch text-center">
                <span class="text-[#575b6f] text-[32px] font-bold font-['IBM Plex Sans Thai']">ผลการค้นหา </span>
                {% if current_filters.q %}
                    <span class="text-[#2162d0] text-[32px] font-bold font-['IBM Plex Sans Thai']">"{{ current_filters.q }}"</span>
                {% endif %}
            </div>
            
            <div class="self-stretch h-auto flex-col justify-start items-center gap-2 flex">
                <div class="self-stretch justify-end items-center inline-flex">
                    <div class="text-center text-[#575b6f] text-base font-normal font-['IBM Plex Sans Thai']">เรียงตาม:</div>
                    <div class="p-2.5 justify-start items-center gap-2.5 flex">
                        <div class="justify-start items-center gap-0.5 flex">
                            <div class="text-[#575b6f] text-base font-bold font-['IBM Plex Sans Thai']">เวลาที่ลงขาย (ล่าสุดก่อน)</div>
                            <img src="{% static 'property-listing/arrowdown.svg' %}" alt="ArrowDown">
                        </div>
                    </div>
                </div>
                
                <!-- Property Listings -->
                <div class="flex flex-wrap gap-6 justify-center">
                    {% for property in properties %}
                    <a href="{% url 'HomeBless:property-detail' property.id %}">
                        <div class="h-auto p-5 rounded-[10px] border border-[#d0d8ef] flex-col justify-start items-start gap-4 inline-flex">
                            <img src="{{ property.main_image }}" class="w-full h-[222px] rounded-md object-cover" alt="PropertyPicture">
                            <div class="self-stretch h-[249px] flex-col justify-start items-start gap-4 flex">
                                <div class="self-stretch h-[180px] flex-col justify-start items-start gap-4 flex">
                                    <div class="self-stretch justify-between items-center inline-flex">
                                        <div class="w-[371px] text-[#444f85] text-base font-bold font-['IBM Plex Sans Thai'] line-clamp-2">{{ property.title }}</div>
                                        <img src="{% static 'property-listing/bookmark.svg' %}" alt="Bookmark">
                                    </div>
                                    <div class="px-[9px] py-2 bg-[#2162d0] rounded-md justify-center items-center gap-1.5 inline-flex">
                                        <img src="{% static 'property-listing/location.svg' %}" alt="Location">
                                        <div class="text-[#faf9f6] text-xs font-normal font-['IBM Plex Sans Thai'] max-w-[150px] truncate overflow-hidden whitespace-nowrap">
                                            {{ property.location }}
                                        </div>
                                    </div>
                                    <div class="self-stretch justify-start items-center inline-flex">
                                        <div class="px-2.5 border-r border-[#575b6f] justify-start items-center gap-1.5 flex">
                                            <div data-svg-wrapper class="relative">
                                                <img src="{% static 'property-listing/area.svg' %}" alt="Area">
                                            </div>
                                            <div class="text-[#575b6f] text-xs font-normal font-['IBM Plex Sans Thai']">{{ property.area }} ตร.ว.</div>
                                        </div>
                                        <div class="px-2.5 justify-start items-center gap-1.5 flex">
                                            <img src="{% static 'property-listing/floor.svg' %}" alt="Floor">
                                            <div class="text-[#575b6f] text-xs font-normal font-['IBM Plex Sans Thai']">{{ property.floors }} ชั้น</div>
                                        </div>
                                        <div class="px-2.5 border-l border-r border-[#575b6f] justify-start items-center gap-1.5 flex">
                                            <img src="{% static 'property-listing/bedroom.svg' %}" alt="Bedroom">
                                            <div class="text-[#575b6f] text-xs font-normal font-['IBM Plex Sans Thai']">{{ property.bedrooms }} ห้องนอน</div>
                                        </div>
                                        <div class="px-2.5 justify-start items-center gap-1.5 flex">
                                            <img src="{% static 'property-listing/bathroom.svg' %}" alt="Bathroom">
                                            <div class="text-[#575b6f] text-xs font-normal font-['IBM Plex Sans Thai']">{{ property.bathrooms }} ห้องน้ำ</div>
                                        </div>
                                    </div>
                                    <div class="justify-start items-center gap-2 inline-flex">
                                        <div class="px-2 py-0.5 bg-[#faf9f6] rounded-md border border-[#d0d8ef] justify-center items-center gap-1.5 flex">
                                            <div class="text-[#575b6f] text-xs font-normal font-['IBM Plex Sans Thai']">เลี้ยงสัตว์ได้</div>
                                        </div>
                                        <div class="px-2 py-0.5 bg-[#faf9f6] rounded-md border border-[#d0d8ef] justify-center items-center gap-1.5 flex">
                                            <div class="text-[#575b6f] text-xs font-normal font-['IBM Plex Sans Thai']">ใกล้อีสวิวล์</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="self-stretch justify-start items-center gap-2 inline-flex">
                                    <div class="grow shrink basis-0 text-[#2DAB6F] text-[32px] font-bold font-['IBM Plex Sans Thai']">
                                        {{ property.price|intcomma }}</div>
                                    <div class="text-[#2DAB6F] text-[32px] font-bold font-['IBM Plex Sans Thai']">
                                        บาท{% if property.transaction_type == "rent" %}/ด.{% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </a>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Pagination -->
            {% if is_paginated %}
            <div class="p-2.5 pb-20 justify-start items-center gap-4 inline-flex">
                <div class="justify-start items-center gap-2 flex">
                    {% if page_obj.has_previous %}
                        <a href="?{% query_transform request page=1 %}">
                            <img src="{% static 'property-listing/double-arrow-left.svg' %}" alt="First">
                        </a>
                        <a href="?{% query_transform request page=page_obj.previous_page_number %}">
                            <img src="{% static 'property-listing/single-arrow-left.svg' %}" alt="Previous">
                        </a>
                    {% endif %}
                    
                    {% for num in page_obj.paginator.page_range %}
                        {% if page_obj.number == num %}
                            <div class="w-10 h-10 bg-[#2162d0] rounded-[50px] flex-col justify-center items-center gap-1.5 inline-flex">
                                <div class="self-stretch text-center text-[#faf9f6] text-base font-normal font-['IBM Plex Sans Thai']">{{ num }}</div>
                            </div>
                        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                            <a href="?{% query_transform request page=num %}" class="w-10 h-10 rounded-[50px] flex-col justify-center items-center gap-1.5 inline-flex">
                                <div class="self-stretch text-center text-[#444f85] text-base font-normal font-['IBM Plex Sans Thai']">{{ num }}</div>
                            </a>
                        {% endif %}
                    {% endfor %}
                    
                    {% if page_obj.has_next %}
                        <a href="?{% query_transform request page=page_obj.next_page_number %}">
                            <img src="{% static 'property-listing/single-arrow-right.svg' %}" alt="Next">
                        </a>
                        <a href="?{% query_transform request page=page_obj.paginator.num_pages %}">
                            <img src="{% static 'property-listing/double-arrow-right.svg' %}" alt="Last">
                        </a>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
    // Filter sidebar toggle
    const filter = document.getElementById("filter");
    filter.addEventListener("mouseenter", () => {
        document.body.style.overflow = "hidden";
    });
    filter.addEventListener("mouseleave", () => {
        document.body.style.overflow = "auto";
    });

    document.getElementById("close-filter").addEventListener("click", function() {
        document.getElementById("filter").style.display = "none";
        document.getElementById("body").classList.remove("w-3/4");
        document.getElementById("body").classList.add("w-full");
        document.getElementById("open-filter").classList.remove("hidden");
    });

    document.getElementById("open-filter").addEventListener("click", function() {
        document.getElementById("filter").style.display = "block";
        document.getElementById("body").classList.remove("w-full");
        document.getElementById("body").classList.add("w-3/4");
        document.getElementById("open-filter").classList.add("hidden");
    });

    // Filter section toggles
    document.getElementById("basic-filter-arrow").addEventListener("click", function() {
        let filter = document.getElementById("basic-filter");
        let arrow = document.getElementById("basic-filter-arrow");
        if (filter.style.display === "none") {
            filter.style.display = "block";
            arrow.style.transform = "rotate(0deg)";
        } else {
            filter.style.display = "none";
            arrow.style.transform = "rotate(180deg)";
        }
    });

    document.getElementById("charac-filter-arrow").addEventListener("click", function() {
        let filter = document.getElementById("charac-filter");
        let arrow = document.getElementById("charac-filter-arrow");
        if (filter.style.display === "none") {
            filter.style.display = "block";
            arrow.style.transform = "rotate(0deg)";
        } else {
            filter.style.display = "none";
            arrow.style.transform = "rotate(180deg)";
        }
    });

    // Auto-submit forms when filters change
    document.querySelectorAll('[onchange*="this.form.submit"]').forEach(el => {
        el.addEventListener('change', function() {
            this.form.submit();
        });
    });

    // For filter buttons that aren't in a form
    document.querySelectorAll('[href^="?"]').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            window.location.href = this.getAttribute('href');
        });
    });
</script>
{% endblock %}